<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Energy, Exergy & Sustainability Calculator</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- MathJax for equations -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Energy, Exergy & Sustainability Calculator</h1>
      <p>Comprehensive thermodynamic analysis tool for diesel engine performance</p>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="showTab('calculator')">Calculator</button>
      <button class="tab" onclick="showTab('equations')">Equations Reference</button>
      <button class="tab" onclick="showTab('pcs')">Combustion Simulation</button>
    </div>

    <!-- CALCULATOR TAB -->
    <div id="calculator-tab" class="tab-content active">
      <div class="calculator-grid">
        <div class="input-section">
          <h2 class="section-title">Input Parameters</h2>

          <!-- INPUTS -->
          <div class="input-group"><label for="fuelMassFlow">Fuel Mass Flow Rate (kg/s):</label><input type="number" id="fuelMassFlow" step="0.0001" value="0.0008"></div>
          <div class="input-group"><label for="lhv">Lower Heating Value (MJ/kg):</label><input type="number" id="lhv" step="0.1" value="42.5"></div>
          <div class="input-group"><label for="engineSpeed">Engine Speed (rpm):</label><input type="number" id="engineSpeed" step="1" value="1500"></div>

          <div class="input-group"><label for="brakeLoad">Brake Load (kg):</label><input type="number" id="brakeLoad" step="0.1" value="10"></div>
          <div class="input-group"><label for="armLength">Arm Length (m):</label><input type="number" id="armLength" step="0.01" value="0.5"></div>

          <div class="input-group"><label for="airMassFlow">Air Mass Flow Rate (kg/s):</label><input type="number" id="airMassFlow" step="0.001" value="0.02"></div>
          <div class="input-group"><label for="waterMassFlow">Cooling Water Mass Flow Rate (kg/s):</label><input type="number" id="waterMassFlow" step="0.001" value="0.15"></div>
          <div class="input-group"><label for="waterTempIn">Water Inlet Temperature (°C):</label><input type="number" id="waterTempIn" step="0.1" value="25"></div>
          <div class="input-group"><label for="waterTempOut">Water Outlet Temperature (°C):</label><input type="number" id="waterTempOut" step="0.1" value="65"></div>
          <div class="input-group"><label for="exhaustTemp">Exhaust Gas Temperature (°C):</label><input type="number" id="exhaustTemp" step="0.1" value="450"></div>
          <div class="input-group"><label for="ambientTemp">Ambient Temperature (°C):</label><input type="number" id="ambientTemp" step="0.1" value="25"></div>
          <div class="input-group">
            <label for="compressionRatio">Compression Ratio:</label>
            <input type="number" id="compressionRatio" step="0.1" value="16">
          </div>
          <div class="input-group">
            <label for="fuelType">Fuel Type:</label>
            <select id="fuelType">
              <option value="diesel">Diesel (B0)</option>
              <option value="biodiesel20">Biodiesel B20</option>
              <option value="custom">Custom</option>
            </select>
          </div>
          
          <!-- CUSTOM FUEL -->
          <div class="input-group" id="customFuelGroup" style="display: none;">
            <h3>Custom Fuel Properties</h3>

            <label for="hcRatio">H/C Ratio:</label>
            <input type="number" id="hcRatio" step="0.01" value="1.8">

            <label for="ocRatio">O/C Ratio:</label>
            <input type="number" id="ocRatio" step="0.01" value="0.0">

            <label for="scRatio">S/C Ratio:</label>
            <input type="number" id="scRatio" step="0.001" value="0.0">

            <hr>

            <label for="fuelDensity">Density (kg/m³):</label>
            <input type="number" id="fuelDensity" step="0.1" value="830">

            <label for="fuelViscosity">Viscosity (cSt):</label>
            <input type="number" id="fuelViscosity" step="0.01" value="2.5">

            <label for="cetaneNumber">Cetane Number:</label>
            <input type="number" id="cetaneNumber" step="0.1" value="50">

            <label for="customLHV">Calorific Value (MJ/kg):</label>
            <input type="number" id="customLHV" step="0.1" value="42.5">

            <label for="flashPoint">Flash Point (°C):</label>
            <input type="number" id="flashPoint" step="0.1" value="55">
          </div>

          <button class="calculate-btn" onclick="calculateAll()">Calculate</button>
          <button class="clear-btn" onclick="clearChartData()">Clear Chart Data</button>
        </div>

        <!-- RESULTS -->
        <div class="results-section">
          <h2 class="section-title">Results</h2>

          <h3>Combined Performance Analysis</h3>
          <div class="chart-container">
            <canvas id="combinedChart"></canvas>
          </div>

          <!-- NUMERIC RESULTS -->
          <div class="result-item"><span class="result-label">Torque (Nm):</span><span class="result-value" id="torqueResult">--</span></div>
          <div class="result-item"><span class="result-label">Input Energy (kW):</span><span id="inputEnergy">--</span></div>
          <div class="result-item"><span class="result-label">Brake Power (kW):</span><span id="brakePower">--</span></div>
          <div class="result-item"><span class="result-label">Cooling Water Energy (kW):</span><span id="coolingWaterEnergy">--</span></div>
          <div class="result-item"><span class="result-label">Exhaust Gas Energy (kW):</span><span id="exhaustGasEnergy">--</span></div>
          <div class="result-item"><span class="result-label">Unaccounted Energy (kW):</span><span id="unaccountedEnergy">--</span></div>
          <div class="result-item"><span class="result-label">Energy Efficiency (%):</span><span id="energyEfficiency">--</span></div>
          <hr>
          <div class="result-item"><span class="result-label">Input Exergy (kW):</span><span id="inputExergy">--</span></div>
          <div class="result-item"><span class="result-label">Shaft Exergy (kW):</span><span id="shaftExergy">--</span></div>
          <div class="result-item"><span class="result-label">Cooling Water Exergy Loss (kW):</span><span id="coolingWaterExergy">--</span></div>
          <div class="result-item"><span class="result-label">Exhaust Gas Exergy Loss (kW):</span><span id="exhaustGasExergy">--</span></div>
          <div class="result-item"><span class="result-label">Exergy Destruction (kW):</span><span id="exergyDestruction">--</span></div>
          <div class="result-item"><span class="result-label">Exergy Efficiency (%):</span><span id="exergyEfficiency">--</span></div>
          <hr>
          <div class="result-item"><span class="result-label">Sustainability Index:</span><span id="sustainabilityIndex">--</span></div>
          <div class="result-item"><span class="result-label">Exergy Performance Coefficient:</span><span id="exergyPerformanceCoeff">--</span></div>
        </div>
      </div>
    </div>

    <!-- EQUATIONS TAB -->
    <div id="equations-tab" class="tab-content">
      <div class="equations-section">
        <h2 class="section-title">Energy & Exergy Analysis Equations</h2>

        <h3>Energy Analysis</h3>
        <p>Input Energy:</p>
        <p>$$ E_{in} = \dot{m}_f \cdot LHV $$</p>

        <p>Brake Power:</p>
        <p>$$ E_{BP} = \frac{2 \pi N T}{60 \cdot 1000} $$</p>

        <p>Cooling Water Energy:</p>
        <p>$$ E_{cw} = \dot{m}_w \cdot C_p \cdot (T_2 - T_1) $$</p>

        <p>Exhaust Gas Energy:</p>
        <p>$$ E_{eg} = (\dot{m}_a + \dot{m}_f) \cdot C_{p,eg} \cdot (T_5 - T_a) $$</p>

        <p>Unaccounted Energy:</p>
        <p>$$ E_{unacc} = E_{in} - (E_{BP} + E_{cw} + E_{eg}) $$</p>

        <p>Energy Efficiency:</p>
        <p>$$ \eta_E = \frac{E_{BP}}{E_{in}} $$</p>

        <h3>Exergy Analysis</h3>
        <p>Chemical Exergy Factor:</p>
        <p>$$ ex_{chem} = 1.0374 + 0.0159(H/C) + 0.0567(O/C) + 0.5985(S/C)(1 - 0.1737(H/C)) $$</p>

        <p>Input Exergy:</p>
        <p>$$ Ex_{in} = \dot{m}_f \cdot LHV \cdot ex_{chem} $$</p>

        <p>Shaft Exergy:</p>
        <p>$$ Ex_{shaft} = E_{BP} $$</p>

        <p>Cooling Water Exergy Loss:</p>
        <p>$$ Ex_{cw} = E_{cw} + \dot{m}_w C_p T_a \ln\left(\frac{T_1}{T_2}\right) $$</p>

        <p>Exhaust Gas Exergy Loss:</p>
        <p>$$ Ex_{eg} = E_{eg} + \Big[ (\dot{m}_a + \dot{m}_f) T_a (C_{p,eg} \ln\frac{T_a}{T_5}) - R_{eg} \ln\frac{P_a}{P_{eg}} \Big] $$</p>

        <p>Exergy Destruction:</p>
        <p>$$ Ex_D = Ex_{in} - (Ex_{shaft} + Ex_{cw} + Ex_{eg}) $$</p>

        <p>Exergy Efficiency:</p>
        <p>$$ \eta_{Ex} = \frac{Ex_{shaft}}{Ex_{in}} $$</p>

        <h3>Sustainability Metrics</h3>
        <p>Sustainability Index:</p>
        <p>$$ SI = \frac{1}{1 - \frac{Ex_{shaft}}{Ex_{in}}} $$</p>

        <p>Exergy Performance Coefficient:</p>
        <p>$$ EPC = \frac{Ex_{shaft}}{Ex_D} $$</p>

        <hr>
        <h3>Symbols</h3>
        <ul class="symbols-list">
          <li>$$ \dot{m}_f $$ : Fuel mass flow rate (kg/s)</li>
          <li>$$ LHV $$ : Lower Heating Value of fuel (kJ/kg)</li>
          <li>$$ N $$ : Engine speed (rpm)</li>
          <li>$$ T $$ : Torque (Nm)</li>
          <li>$$ \dot{m}_w $$ : Cooling water mass flow rate (kg/s)</li>
          <li>$$ C_p $$ : Specific heat (kJ/kg·K)</li>
          <li>$$ T_1, T_2 $$ : Cooling water inlet & outlet temperatures (K)</li>
          <li>$$ T_a $$ : Ambient temperature (K)</li>
          <li>$$ T_5 $$ : Exhaust gas temperature (K)</li>
          <li>$$ P_a, P_{eg} $$ : Ambient & exhaust pressures (bar)</li>
          <li>$$ R_{eg} $$ : Exhaust gas constant (kJ/kg·K)</li>
        </ul>
      </div>
    </div>

    <!-- ==================== PCS TAB - FIXED LAYOUT ==================== -->
    <div id="pcs-tab" class="tab-content">
      <div class="pcs-container">
        <!-- Input Section -->
        <div class="input-section">
          <h2 class="section-title">Progressive Combustion Simulation (PCS)</h2>
          <p class="small">0-D Wiebe heat-release progressive-combustion model. Outputs per-cycle P–θ and heat release.</p>

          <div class="input-grid pcs-inputs">
            <div class="input-group"><label for="pcs_bore">Bore (m)</label><input id="pcs_bore" type="number" step="0.001" value="0.08"></div>
            <div class="input-group"><label for="pcs_stroke">Stroke (m)</label><input id="pcs_stroke" type="number" step="0.001" value="0.09"></div>
            <div class="input-group"><label for="pcs_conrod">Conrod length (m)</label><input id="pcs_conrod" type="number" step="0.001" value="0.15"></div>
            <div class="input-group"><label for="pcs_cr">Compression ratio</label><input id="pcs_cr" type="number" step="0.1" value="17"></div>

            <div class="input-group"><label for="pcs_gamma">Gamma (γ)</label><input id="pcs_gamma" type="number" step="0.01" value="1.35"></div>
            <div class="input-group"><label for="pcs_soc">Start of combustion SOC (deg)</label><input id="pcs_soc" type="number" step="1" value="355"></div>
            <div class="input-group"><label for="pcs_dur">Combustion duration (deg)</label><input id="pcs_dur" type="number" step="1" value="40"></div>
            <div class="input-group"><label for="pcs_a">Wiebe a</label><input id="pcs_a" type="number" step="0.1" value="5"></div>

            <div class="input-group"><label for="pcs_m">Wiebe m</label><input id="pcs_m" type="number" step="0.1" value="2"></div>
            <div class="input-group"><label for="pcs_fuel">Fuel mass per cycle (g)</label><input id="pcs_fuel" type="number" step="0.001" value="0.015"></div>
            <div class="input-group"><label for="pcs_lhv">Fuel LHV (kJ/kg)</label><input id="pcs_lhv" type="number" step="10" value="43000"></div>
            <div class="input-group"><label for="pcs_initp">Initial pressure (Pa)</label><input id="pcs_initp" type="number" step="100" value="101325"></div>
          </div>

          <button id="pcs_run" class="calculate-btn">Run Simulation</button>
        </div>

        <!-- Results Section -->
        <div class="results-section pcs-results">
          <h3 class="section-title">Simulation Output</h3>
          
          <!-- Numeric Results ABOVE Charts -->
          <div class="pcs-numeric-results">
            <div class="result-item">
              <span class="result-label">Indicated Work (kJ):</span>
              <span class="result-value" id="pcs_W">--</span>
            </div>
            <div class="result-item">
              <span class="result-label">Approx. Thermal Efficiency (%):</span>
              <span class="result-value" id="pcs_eta">--</span>
            </div>
          </div>

          <!-- Charts -->
          <div class="pcs-charts">
            <div class="pcs-chart-wrapper">
              <h4>Pressure vs Crank Angle (P–θ)</h4>
              <canvas id="pcs_chartP"></canvas>
            </div>

            <div class="pcs-chart-wrapper">
              <h4>Heat Release Rate vs Crank Angle (dQ/dθ)</h4>
              <canvas id="pcs_chartQ"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- ==================== PCS TAB END ==================== -->

  </div>

  <script src="script.js"></script>
</body>
</html>